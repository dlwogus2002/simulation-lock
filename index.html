<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œë®¬ë ˆì´ì…˜ ì ìœ  í˜„í™©</title>
    <style>
        body { font-family: sans-serif; background: #f5f7fa; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        .badge { padding: 8px 16px; border-radius: 50px; font-weight: bold; display: inline-block; margin-bottom: 15px; }
        .free { background: #e3f2fd; color: #1976d2; }
        .busy { background: #ffebee; color: #d32f2f; }
        .user-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
        .user-item { border: 1px solid #ddd; padding: 10px; border-radius: 8px; cursor: pointer; }
        .user-item.selected { border: 2px solid #d32f2f; background: #fff5f5; color: #d32f2f; font-weight: bold; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold; }
        .btn-in { background: #d32f2f; color: white; }
        .btn-out { background: #e74c3c; color: white; }
        .warning-text { color: #e74c3c; font-size: 13px; margin-top: 12px; font-weight: bold; display: block; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="card">
    <div id="statusBadge" class="badge free">âœ… ì‚¬ìš© ê°€ëŠ¥</div>
    <h2 id="statusTitle">í˜„ì¬ ë¹„ì–´ìˆìŒ</h2>

    <div id="loginArea">
        <p>ëˆ„ê°€ ì‚¬ìš©í•˜ì‹œë‚˜ìš”?</p>
        <div class="user-list">
            <div class="user-item" onclick="sel('ì¬í˜„')">ì¬í˜„</div>
            <div class="user-item" onclick="sel('í˜„ìš°')">í˜„ìš°</div>
            <div class="user-item" onclick="sel('ì„¸í˜•')">ì„¸í˜•</div>
            <div class="user-item" onclick="sel('ì§€ì˜')">ì§€ì˜</div>
        </div>
        <button id="inBtn" class="btn-in" onclick="connect()" disabled>ì ‘ì†í•˜ê¸°</button>
    </div>

    <div id="logoutArea" class="hidden">
        <button class="btn-out" onclick="disconnect()">ì ‘ì† ì¢…ë£Œ</button>
        <span class="warning-text">âš ï¸ ë³¸ì¸ ì™¸ì— ëˆ„ë¥´ì§€ ë§ˆì„¸ìš”</span>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        databaseURL: "https://simapp-a2c75-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, 'room/status');

    let myName = "";

    window.sel = (name) => {
        myName = name;
        document.querySelectorAll('.user-item').forEach(el => {
            el.classList.toggle('selected', el.innerText === name);
        });
        document.getElementById('inBtn').disabled = false;
    };

    window.connect = () => {
        set(dbRef, { user: myName, active: true });
    };

    window.disconnect = () => {
        if(confirm("ì •ë§ë¡œ ì ‘ì†ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            set(dbRef, { user: "", active: false });
        }
    };

    onValue(dbRef, (snap) => {
        const data = snap.val();
        const badge = document.getElementById('statusBadge');
        const title = document.getElementById('statusTitle');
        const loginArea = document.getElementById('loginArea');
        const logoutArea = document.getElementById('logoutArea');

        if (data && data.active) {
            badge.innerText = "ğŸš¨ ì ‘ì† ì¤‘";
            badge.className = "badge busy";
            title.innerText = data.user + " ë‹˜ì´ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.";
            
            // í•µì‹¬ ë³€ê²½: ëˆ„êµ°ê°€ ì‚¬ìš© ì¤‘ì´ë©´ ëˆ„êµ¬ë‚˜ 'ì ‘ì† ì¢…ë£Œ' ë²„íŠ¼ì„ ë³¼ ìˆ˜ ìˆìŒ
            loginArea.classList.add('hidden');
            logoutArea.classList.remove('hidden');
        } else {
            badge.innerText = "âœ… ì‚¬ìš© ê°€ëŠ¥";
            badge.className = "badge free";
            title.innerText = "í˜„ì¬ ë¹„ì–´ìˆìŒ";
            loginArea.classList.remove('hidden');
            logoutArea.classList.add('hidden');
            
            // ì´ˆê¸°í™”
            myName = "";
            document.querySelectorAll('.user-item').forEach(el => el.classList.remove('selected'));
            document.getElementById('inBtn').disabled = true;
        }
    });
</script>

</body>
</html>
