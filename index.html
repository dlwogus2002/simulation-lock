<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œë®¬ë ˆì´ì…˜ ì‚¬ìš© í˜„í™©</title>
    <style>
        :root { --primary: #4a90e2; --danger: #e74c3c; --bg: #f5f6fa; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .app-container { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; }
        .status-badge { display: inline-block; padding: 8px 16px; border-radius: 20px; font-weight: bold; margin-bottom: 20px; }
        .status-free { background: #e1f5fe; color: #01579b; }
        .status-busy { background: #ffebee; color: #c62828; }
        .user-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
        .user-option { border: 2px solid #ddd; padding: 15px; border-radius: 12px; cursor: pointer; transition: 0.3s; }
        .user-option.active { border-color: var(--primary); background: #f0f7ff; color: var(--primary); }
        button { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-connect { background: var(--primary); color: white; }
        .btn-disconnect { background: var(--danger); color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="statusArea">
        <div id="statusDisplay" class="status-badge status-free">í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥</div>
        <h2 id="mainMessage">ì§€ê¸ˆ ëˆ„ê°€ ì“¸ê¹Œìš”?</h2>
    </div>

    <div id="setupView">
        <div class="user-grid" id="userList">
            <div class="user-option" onclick="selectUser('ì¬í˜„')">ì¬í˜„</div>
            <div class="user-option" onclick="selectUser('í˜„ìš°')">í˜„ìš°</div>
            <div class="user-option" onclick="selectUser('ì„¸í˜•')">ì„¸í˜•</div>
            <div class="user-option" onclick="selectUser('ì§€ì˜')">ì§€ì˜</div>
        </div>
        <button class="btn-connect" id="connectBtn" onclick="startUsing()" disabled>ì ‘ì†í•˜ê¸°</button>
    </div>

    <div id="usingView" class="hidden">
        <button class="btn-disconnect" onclick="stopUsing()">ì ‘ì† ì¢…ë£Œ</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    // ğŸ”´ ì¤‘ìš”: ë³¸ì¸ì˜ Firebase ì„¤ì •ê°’ìœ¼ë¡œ êµì²´í•´ì•¼ í•©ë‹ˆë‹¤!
    const firebaseConfig = {
        databaseURL: "https://simapp-a2c75-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const statusRef = ref(db, 'sim-status');

    let currentUser = "";

    // ì‹¤ì‹œê°„ ìƒíƒœ ê°ì‹œ
    onValue(statusRef, (snapshot) => {
        const data = snapshot.val();
        updateUI(data);
    });

    // ì‚¬ìš©ì ì„ íƒ í•¨ìˆ˜
    window.selectUser = (name) => {
        currentUser = name;
        document.querySelectorAll('.user-option').forEach(el => {
            el.classList.toggle('active', el.innerText === name);
        });
        document.getElementById('connectBtn').disabled = false;
    };

    // ì ‘ì† ì‹œì‘
    window.startUsing = () => {
        set(statusRef, { user: currentUser, isBusy: true });
    };

    // ì ‘ì† ì¢…ë£Œ
    window.stopUsing = () => {
        set(statusRef, { user: "", isBusy: false });
    };

    // UI ì—…ë°ì´íŠ¸ ë¡œì§
    function updateUI(data) {
        const display = document.getElementById('statusDisplay');
        const msg = document.getElementById('mainMessage');
        const setup = document.getElementById('setupView');
        const using = document.getElementById('usingView');

        if (data && data.isBusy) {
            display.innerText = "ğŸš¨ ì ‘ì† ì¤‘";
            display.className = "status-badge status-busy";
            msg.innerText = `${data.user} ë‹˜ì´ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.`;
            
            // ë‚´ê°€ ì ‘ì† ì¤‘ì´ë¼ë©´ ì¢…ë£Œ ë²„íŠ¼ë§Œ ë³´ì—¬ì¤Œ
            if (data.user === currentUser) {
                setup.classList.add('hidden');
                using.classList.remove('hidden');
            } else {
                setup.classList.add('hidden'); // ë‹¤ë¥¸ ì‚¬ëŒì´ ì“°ë©´ ì„ íƒ ëª»í•˜ê²Œ ìˆ¨ê¹€
            }
        } else {
            display.innerText = "âœ… ì‚¬ìš© ê°€ëŠ¥";
            display.className = "status-badge status-free";
            msg.innerText = "ì§€ê¸ˆ ëˆ„ê°€ ì“¸ê¹Œìš”?";
            setup.classList.remove('hidden');
            using.classList.add('hidden');
        }
    }
</script>
</body>
</html>


